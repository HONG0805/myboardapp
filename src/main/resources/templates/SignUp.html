<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<title>ê°•ë‚¨ëŒ€í•™êµ ì¤‘ê³ ì¥í„° íšŒì›ê°€ì…</title>
<link rel="stylesheet" th:href="@{/css/SignUp.css}">
<link rel="stylesheet" th:href="@{/css/reset.css}">
<link rel="shortcut icon" th:href="@{/images/favicon/favicon.ico}">
<link rel="apple-touch-icon-precomposed"
	th:href="@{/images/favicon/flat-design-touch.png}">

<script src="https://kit.fontawesome.com/e1bd1cb2a5.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>

<script type="text/javascript">
    // íšŒì›ê°€ì… í¼ ê²€ì¦ í•¨ìˆ˜
    function registerUser() {
        var userID = $("#userID").val().trim();
        var userPassword = $("#userPassword").val().trim();
        var userPasswordCheck = $("#userPasswordCheck").val().trim();
        var userEmail = $("#userEmail").val().trim();
        var userName = $("#userName").val().trim();

        var idReg = /^[a-z0-9]{4,20}$/;
        var pwReg = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*()_+={}\[\]:;"'<>,.?/\\|-]).{8,20}$/;
        var emailReg = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
        var nameReg = /^[ê°€-ía-zA-Z]{2,30}$/;

        if (!idReg.test(userID)) {
            alert("ì•„ì´ë””ëŠ” 4~20ìì˜ ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return false;
        }

        if (!pwReg.test(userPassword)) {
            alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8~20ìì˜ ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            return false;
        }

        if (userPassword !== userPasswordCheck) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return false;
        }

        if (!emailReg.test(userEmail)) {
            alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return false;
        }

        if (!nameReg.test(userName)) {
            alert("ì´ë¦„ì€ 2~30ìì˜ í•œê¸€ ë˜ëŠ” ì˜ë¬¸ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return false;
        }

        console.log("í¼ ì œì¶œë¨");
        return true;
    }

    function checkID() {
        let userID = $("#userID").val().trim();

        if (userID.length < 4 || userID.length > 20) {
            alert("ì•„ì´ë””ëŠ” 4~20ìë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        $.ajax({
            type: "GET",
            url: "/user/checkID",
            data: { userID: userID },
            success: function(response) {
                alert(response);
            },
            error: function(xhr) {
                alert("ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

    function togglePassword(id) {
        let input = document.getElementById(id);
        if (input.type === "password") {
            input.type = "text";
        } else {
            input.type = "password";
        }
    }
</script>
</head>
<body>
	<div id="wrap">
		<header class="header">
			<h1>
				<a th:href="@{/user/login}">Kangnam University</a>
			</h1>
			<div>
				<h3>
					<a th:href="@{/user/login}">ì¤‘ê³ ì¥í„°</a>
				</h3>
			</div>
		</header>

		<section class="sign_section">
			<div class="signup">
				<form th:action="@{/user/register}" method="post"
					onsubmit="return registerUser()">
					<input type="hidden" th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}" />
					<h2>íšŒì›ê°€ì…</h2>
					
					<div th:if="${error}" class="alert"
						style="color: red; margin-bottom: 10px;" th:text="${error}"></div>
					<div th:if="${message}" class="alert"
						style="color: green; margin-bottom: 10px;" th:text="${message}"></div>

					<div class="text">ì•„ì´ë””</div>
					<div>
						<input type="text" id="userID" name="userID"
							placeholder="ì•„ì´ë”” (4~20ì)" class="input_text" maxlength="20"
							required>
						<button type="button" onclick="checkID()">ì¤‘ë³µ í™•ì¸</button>
					</div>

					<div class="text">
						ë¹„ë°€ë²ˆí˜¸ <span style="font-size: 10px;">(8~20ì, ëŒ€ì†Œë¬¸ì,ìˆ«ì,íŠ¹ìˆ˜ë¬¸ì
							í¬í•¨)</span>
					</div>
					<div>
						<input type="password" id="userPassword" name="userPassword"
							placeholder="ë¹„ë°€ë²ˆí˜¸" class="input_text" maxlength="20" required>
						<button type="button" onclick="togglePassword('userPassword')">ğŸ‘ï¸</button>
					</div>

					<div class="text">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</div>
					<div>
						<input type="password" id="userPasswordCheck"
							name="userPasswordCheck" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" class="input_text"
							maxlength="20" required>
						<button type="button"
							onclick="togglePassword('userPasswordCheck')">ğŸ‘ï¸</button>
					</div>

					<div class="text">ì´ë©”ì¼</div>
					<div>
						<input type="email" id="userEmail" name="userEmail"
							placeholder="ì´ë©”ì¼@example.com" class="input_text" maxlength="50"
							required>
					</div>

					<div class="text">ì´ë¦„</div>
					<div>
						<input type="text" id="userName" name="userName"
							placeholder="ì´ë¦„ (2~30ì)" class="input_text" maxlength="30"
							required>
					</div>

					<div class="signbtn">
						<button type="submit" class="bt_signup">íšŒì›ê°€ì…</button>
					</div>
				</form>
			</div>
		</section>
	</div>
</body>
</html>
